- content_for :head do
  = javascript_include_tag 'view_models/thresholds_view_model'
  = javascript_include_tag 'maps/thresholds_map'

  :javascript
    $(function() { 
      rm.set({ collection_id: #{collection.id} });
      rm.bootstrap();
    });

= render 'collections/tabs'

.tabsline
  %h2 Thresholds
  <!-- ko foreach :thresholds -->
  .box.grey.w60{ ko(visible: '$data != $root.currentThreshold()') }
    .ord-buttons
      %input{ ko(value: :priority) }
      %button.up{ ko(click: '$root.moveThresholdUp'), title: 'Move up' }
      %button.down{ ko(click: '$root.moveThresholdDown'), title: 'Move down' }
    .toptitle 
      %span
        When
        %span{ ko(text: :field) }
        is
        %span{ ko(text: :comparisonText) }
        %span{ ko(text: :value) }
        , set color
        %span.stat{ ko(style: {backgroundColor: :color, borderTop: :borderTopStyle}) }
    .rightbuttons 
      %button.fdelete{ ko(click: '$root.deleteThreshold') }
    .middlebuttons
    %button.farrow Edit
  %br{ ko({visible: :id}) }

  .box.w60{ ko(visible: '$data == $root.currentThreshold()') }
    .rightbuttons
      %button.fdelete
    %label Conditions
    .middlebuttons
      when
      = select_tag :fields_option, options_for_select([['Bed', 'bed'], ['Hospital', 'hospital'], ['Car Garage', 'car garage'], ['Petro Station', 'petro station']]), "data-bind" => kov(value: :field)
      = select_tag :comparison_option, options_for_select([['is less than', 'lt'], ['is greater than', 'gt']]), "data-bind" => kov(value: :comparisonValue)
      = select_tag :value_or_percent_option, options_for_select([['a value of', 'value'], ['a percent of', 'percent']]), "data-bind" => kov(value: :valueOrPercent)
      %span.ux-nstep.w06 
        %input{ko(value: 'condition().value'), style: ":size => '2', :type => 'text'"}
        %button.kdown{:type => "button"}
        %button.kup{:type => "button"}
      %span.stat-r{ko(value: :color)}
      %button.premove 
    .middlebuttons
      %select
        %option Or
      %select  
        %option Ocupation
      %select
        %option is more than
      %select
        %option a percent of
      %span.ux-nstep.w06 
        %input{:size => "2", :type => "text", :value => "15"}
        %button.kdown{:type => "button"}
        %button.kup{:type => "button"}
      %span.stat-r
      %button.fremove 
    %button.fadd
      Add new condition

    %hr
    .bottom-actions
      %button.white{ko(click: "$root.addThreshold")}
        Save
      %a.tgrey{ ko(click: '$root.cancelThreshold'), href: 'javascript:void(0)' } Cancel
  <!-- /ko --> 

  -# New threshold link
  .box.grey.add{ ko(visible: 'state() == "listing"', click: 'showAddThreshold'), style: 'display:none'}
    %span
      Add threshold
    %button.cadd.right
    %br{clear: :all}
